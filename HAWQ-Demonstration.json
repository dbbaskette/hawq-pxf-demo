{"paragraphs":[{"text":"print(\"%html <h3><center>Working with PXF and External Data</h3>\")\nprint(\"<h4><center>HAWQ Extension Framework (PXF) is an extensible framework that allows HAWQ to query external system data. PXF includes built-in connectors for accessing data inside HDFS files, Hive tables, and HBase tables. PXF also integrates with HCatalog to query Hive tables directly.</h4>\")\nprint(\"<center><img src=https://github.com/dbbaskette/zeppelin-notebooks/blob/master/images/pxf-arch.png?raw=true'  style='width:800px;'/>\")","dateUpdated":"2016-12-11T20:30:34-0800","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685601_1644751415","id":"20161005-143117_844709841","result":{"code":"SUCCESS","type":"HTML","msg":"<h3><center>Working with PXF and External Data</h3><h4><center>HAWQ Extension Framework (PXF) is an extensible framework that allows HAWQ to query external system data. PXF includes built-in connectors for accessing data inside HDFS files, Hive tables, and HBase tables. PXF also integrates with HCatalog to query Hive tables directly.</h4><center><img src=https://github.com/dbbaskette/zeppelin-notebooks/blob/master/images/pxf-arch.png?raw=true'  style='width:800px;'/>"},"dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:427","dateFinished":"2016-12-11T20:31:10-0800","dateStarted":"2016-12-11T20:30:34-0800","focus":true},{"text":"print(\"%html <h3><center>Using PXF to Query CSV and JSON</h3>\")\nprint(\"<center><table style='width:20%'> <tr> <th><img src='http://www.clker.com/cliparts/b/8/8/2/1369900380534177305csv_file-md.png'  style='width:170px;'/></th><th><img src='http://itecsoftware.com/wp-content/uploads/2009/09/json-extension-linux-300x200.jpg'  style='width:300px;'/></th> </tr></table>\")","dateUpdated":"2016-12-11T20:30:35-0800","config":{"colWidth":12,"editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685602_1645905662","id":"20161005-143122_1205469717","result":{"code":"SUCCESS","type":"HTML","msg":"<h3><center>Using PXF to Query CSV and JSON</h3><center><table style='width:20%'> <tr> <th><img src='http://www.clker.com/cliparts/b/8/8/2/1369900380534177305csv_file-md.png'  style='width:170px;'/></th><th><img src='http://itecsoftware.com/wp-content/uploads/2009/09/json-extension-linux-300x200.jpg'  style='width:300px;'/></th> </tr></table>"},"dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:428","dateFinished":"2016-12-11T20:31:10-0800","dateStarted":"2016-12-11T20:30:36-0800","focus":true},{"text":"%psql.sql\n\nDROP SCHEMA IF EXISTS text CASCADE;\nCREATE SCHEMA text;\nDROP EXTERNAL TABLE IF EXISTS  text.customer;\nCREATE EXTERNAL TABLE text.customer \n    ( c_customer_sk             bigint              \n  , c_customer_id             text              \n  , c_current_cbigbench_sk        bigint\n  , c_current_hbigbench_sk        bigint\n  , c_current_addr_sk         bigint\n  , c_first_shipto_date_sk    bigint\n  , c_first_sales_date_sk     bigint\n  , c_salutation              text\n  , c_first_name              text\n  , c_last_name               text\n  , c_preferred_cust_flag     text\n  , c_birth_day               int\n  , c_birth_month             int\n  , c_birth_year              int\n  , c_birth_country           text\n  , c_login                   text\n  , c_email_address           text\n  , c_last_review_date        text\n)\nLOCATION ('pxf://sandbox:51200 /hawq-sandbox-demos/customer?Profile=HdfsTextSimple') FORMAT 'CSV' (DELIMITER='|');","dateUpdated":"2016-12-11T20:24:18-0800","config":{"tableHide":true,"colWidth":5,"editorMode":"ace/mode/sql","editorHide":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Update Count","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"Update Count","index":0,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685602_1645905662","id":"20161005-143148_408884781","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:429","dateFinished":"2016-12-11T20:24:20-0800","dateStarted":"2016-12-11T20:24:18-0800","focus":true},{"text":"%file\n\nls /hawq-sandbox-demos/customer\n\n\n    ","dateUpdated":"2016-12-11T20:24:22-0800","config":{"colWidth":6,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685603_1645520913","id":"20161005-143222_586237845","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:430","dateFinished":"2016-12-11T20:24:23-0800","dateStarted":"2016-12-11T20:24:22-0800","focus":true},{"text":"%psql.sql\n\nselect * from text.customer limit 8;\n\n","dateUpdated":"2016-12-11T20:24:25-0800","config":{"colWidth":11,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"c_customer_sk","index":0,"aggr":"sum"}],"values":[{"name":"c_customer_id","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"c_customer_sk","index":0,"aggr":"sum"},"yAxis":{"name":"c_customer_id","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685603_1645520913","id":"20161005-143226_1115814415","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:431","dateFinished":"2016-12-11T20:24:27-0800","dateStarted":"2016-12-11T20:24:25-0800","focus":true},{"text":"print(\"%html <h3><center>Using PXF and HCatalog to Query Hive</h3>\")\nprint(\"<h5><center>Hive tables can be queried directly through HCatalog integration with HAWQ and PXF, regardless of the underlying file storage format</h5>\")\nprint(\"<center><img src='https://upload.wikimedia.org/wikipedia/commons/b/bb/Apache_Hive_logo.svg'  style='width:200px;'/>\")","dateUpdated":"2016-12-11T20:30:37-0800","config":{"colWidth":12,"editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685603_1645520913","id":"20161005-144358_1672130692","result":{"code":"SUCCESS","type":"HTML","msg":"<h3><center>Using PXF and HCatalog to Query Hive</h3><h5><center>Hive tables can be queried directly through HCatalog integration with HAWQ and PXF, regardless of the underlying file storage format</h5><center><img src='https://upload.wikimedia.org/wikipedia/commons/b/bb/Apache_Hive_logo.svg'  style='width:200px;'/>"},"dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:432","dateFinished":"2016-12-11T20:31:11-0800","dateStarted":"2016-12-11T20:31:10-0800","focus":true},{"title":"View Apache Hive tables","text":"%hive\nshow tables in hive","dateUpdated":"2016-12-11T20:24:31-0800","config":{"colWidth":11,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"tab_name","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"tab_name","index":0,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685603_1645520913","id":"20161005-144401_467075856","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:433","dateFinished":"2016-12-11T20:24:41-0800","dateStarted":"2016-12-11T20:24:31-0800","focus":true},{"title":"Query Apache Hive Table","text":"%hive\nselect * from hive.customer limit 8","dateUpdated":"2016-12-11T20:24:32-0800","config":{"colWidth":11,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685603_1645520913","id":"20161005-144307_1426422771","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:434","dateFinished":"2016-12-11T20:24:41-0800","dateStarted":"2016-12-11T20:24:34-0800","focus":true},{"title":"Query Apache Hive Table via Apache HAWQ and PXF","text":"%psql.sql\nselect * from hcatalog.hive.customer limit 10;","dateUpdated":"2016-12-11T20:24:34-0800","config":{"colWidth":11,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685603_1645520913","id":"20161005-144355_1381788096","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:435","dateFinished":"2016-12-11T20:24:39-0800","dateStarted":"2016-12-11T20:24:34-0800","focus":true},{"title":"Query Apache HAWQ","text":"%psql.sql\n\nselect * from hawq.customer limit 100;","dateUpdated":"2016-12-11T20:24:36-0800","config":{"colWidth":11,"editorMode":"ace/mode/sql","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685603_1645520913","id":"20161209-085626_1594164230","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:436","dateFinished":"2016-12-11T20:24:40-0800","dateStarted":"2016-12-11T20:24:36-0800","focus":true},{"text":"","dateUpdated":"2016-12-11T20:30:39-0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685603_1645520913","id":"20161209-090458_1780815053","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:437","dateFinished":"2016-12-11T20:31:11-0800","dateStarted":"2016-12-11T20:31:11-0800","focus":true},{"text":"print(\"%html <h3><center>Using PXF and HBase</h3>\")\nprint(\"<h5><center>HBase tables can be queried directly through HAWQ and PXF</h5>\")\nprint(\"<h5 style='color:blue;'><center>NOTE: HBASE is not installed in this Sandbox by Default,</h5>\")\nprint(\"<h5 style='color:blue;'><center>      so this section will not run initially</h5>\")\nprint(\"<center><img src='http://hbase.apache.org/images/hbase_logo_with_orca_large.png'  style='width: 400px;'/>\")","dateUpdated":"2016-12-11T20:30:40-0800","config":{"colWidth":12,"editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-145233_1902648444","result":{"code":"SUCCESS","type":"HTML","msg":"<h3><center>Using PXF and HBase</h3><h5><center>HBase tables can be queried directly through HAWQ and PXF</h5><h5 style='color:blue;'><center>NOTE: HBASE is not installed in this Sandbox by Default,</h5><h5 style='color:blue;'><center>      so this section will not run initially</h5><center><img src='http://hbase.apache.org/images/hbase_logo_with_orca_large.png'  style='width: 400px;'/>"},"dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:438","dateFinished":"2016-12-11T20:31:11-0800","dateStarted":"2016-12-11T20:31:11-0800","focus":true},{"text":"%hbase\n\nlist","dateUpdated":"2016-12-11T08:08:05-0800","config":{"colWidth":4,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-145327_1612869458","dateCreated":"2016-12-11T08:08:05-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:439"},{"text":"%hbase\n\ndescribe 'customer'\n\n\n","dateUpdated":"2016-12-11T08:08:05-0800","config":{"colWidth":7,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-145325_1836891489","dateCreated":"2016-12-11T08:08:05-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:440"},{"text":"%hbase\n\nget 'customer', '10005'","dateUpdated":"2016-12-11T08:08:05-0800","config":{"colWidth":6,"editorMode":"ace/mode/scala","tableHide":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-144259_1211597244","dateCreated":"2016-12-11T08:08:05-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:441"},{"text":"%psql.sql\nDROP SCHEMA IF EXISTS hbase CASCADE;\nCREATE SCHEMA hbase;\nDROP EXTERNAL TABLE IF EXISTS hbase.customer;\nCREATE EXTERNAL TABLE hbase.customer\n  ( \n   -- c_customer_sk              bigint    \n    recordkey \t\t\t\t\t integer\n  , \"cf1:c_customer_id\"          text              \n  , \"cf1:c_current_cbigbench_sk\" bigint\n  , \"cf1:c_current_hbigbench_sk\" bigint\n  , \"cf1:c_current_addr_sk\"      bigint\n  , \"cf1:c_first_shipto_date_sk\" bigint\n  , \"cf1:c_first_sales_date_sk\"  bigint\n  , \"cf1:c_salutation\"           text\n  , \"cf1:c_first_name\"           text\n  , \"cf1:c_last_name\"\t\t\t text\n  , \"cf1:c_preferred_cust_flag\"  text\n  , \"cf1:c_birth_day\"            int\n  , \"cf1:c_birth_month\"          int\n  , \"cf1:c_birth_year\"           int\n  , \"cf1:c_birth_country\"        text\n  , \"cf1:c_login\"                text\n  , \"cf1:c_email_address\"        text\n  , \"cf1:c_last_review_date\"     text\n)\nLOCATION ('pxf://sandbox:51200/customer?Profile=HBase')\nFORMAT 'CUSTOM' (formatter='pxfwritable_import');\n\nDROP  EXTERNAL TABLE IF EXISTS hbase.customer_demographics;\nCREATE EXTERNAL TABLE hbase.customer_demographics\n  ( \n     recordkey                      bigint               \n  , \"cf1:cd_gender\"                 text\n  , \"cf1:cd_marital_status\"         text\n  , \"cf1:cd_education_status\"       text\n  , \"cf1:cd_purchase_estimate\"      text\n  , \"cf1:cd_credit_rating\"          text\n  , \"cf1:cd_dep_count\"              text\n  , \"cf1:cd_dep_employed_count\"     text\n  , \"cf1:cd_dep_college_count\"      text\n  )\nLOCATION ('pxf://sandbox:51200/customer_demographics?Profile=HBase')FORMAT 'CUSTOM' (formatter='pxfwritable_import');","dateUpdated":"2016-12-11T08:08:05-0800","config":{"colWidth":5,"tableHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Update Count","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"Update Count","index":0,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-145650_2036760239","dateCreated":"2016-12-11T08:08:05-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:442"},{"text":"%psql.sql\nselect * from hbase.customer limit 10;","dateUpdated":"2016-12-11T08:08:05-0800","config":{"colWidth":11,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-145652_292243896","dateCreated":"2016-12-11T08:08:05-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:443"},{"text":"%psql.sql\n\nselect * from hbase.customer where recordkey=10005;","dateUpdated":"2016-12-11T08:08:05-0800","config":{"colWidth":11,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"recordkey","index":0,"aggr":"sum"}],"values":[{"name":"cf1:c_customer_id","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"recordkey","index":0,"aggr":"sum"},"yAxis":{"name":"cf1:c_customer_id","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-145648_1763403654","dateCreated":"2016-12-11T08:08:05-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:444"},{"text":"print(\"%html <h3><center>Advanced Analytics and Machine Learning with Apache HAWQ and Apache MADlib</h3>\")\nprint(\"<center><img src='https://cwiki.apache.org/confluence/download/attachments/61318291/logo-hawq.png'  style='width: 200px;'/>\")\nprint(\"<center><img src='https://cwiki.apache.org/confluence/download/thumbnails/61319606/Mad_400X400.png'  style='width: 150px;'/>\")","dateUpdated":"2016-12-11T20:30:42-0800","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-145645_1866891826","result":{"code":"SUCCESS","type":"HTML","msg":"<h3><center>Advanced Analytics and Machine Learning with Apache HAWQ and Apache MADlib</h3><center><img src='https://cwiki.apache.org/confluence/download/attachments/61318291/logo-hawq.png'  style='width: 200px;'/><center><img src='https://cwiki.apache.org/confluence/download/thumbnails/61319606/Mad_400X400.png'  style='width: 150px;'/>"},"dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:445","dateFinished":"2016-12-11T20:31:12-0800","dateStarted":"2016-12-11T20:31:11-0800","focus":true},{"title":"List of the Top 5 products most frequently sold together (BEER and DIAPERS Problem)","text":"%psql.sql\n\nSELECT sub1.ss_item_sk as item_sk_1, sub2.ss_item_sk as item_sk_2, COUNT(*) AS cnt\n FROM\n(\nSELECT ss_ticket_number, ss_item_sk\nFROM hawq.store_sales s, hawq.item i\nWHERE s.ss_item_sk = i.i_item_sk\nAND i.i_category_id in (1,2,3)\nAND s.ss_store_sk IN (10, 20, 33, 40, 50)\nGROUP BY ss_ticket_number, ss_item_sk\n) as sub1\njoin \n(\nSELECT ss_ticket_number, ss_item_sk\nFROM hawq.store_sales s, hawq.item i\nWHERE s.ss_item_sk = i.i_item_sk\nAND i.i_category_id in (1,2,3)\nAND s.ss_store_sk IN (10, 20, 33, 40, 50)\nGROUP BY ss_ticket_number, ss_item_sk\n) as sub2 on sub1.ss_ticket_number = sub2.ss_ticket_number and sub1.ss_item_sk <> sub2.ss_item_sk\nGROUP BY sub1.ss_item_sk, sub2.ss_item_sk\nHAVING count(*) > 50\nORDER BY 3 DESC, 1, 2\nLIMIT 5;\n","dateUpdated":"2016-12-11T20:24:47-0800","config":{"colWidth":11,"editorMode":"ace/mode/sql","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"item_sk_1","index":0,"aggr":"sum"}],"values":[{"name":"item_sk_2","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"item_sk_1","index":0,"aggr":"sum"},"yAxis":{"name":"item_sk_2","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-150053_2106783689","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:446","dateFinished":"2016-12-11T20:24:49-0800","dateStarted":"2016-12-11T20:24:47-0800","focus":true},{"title":"Linear Regression to predict interest in categories based on clickstream info and customer demographics.","dateUpdated":"2016-12-11T20:30:44-0800","config":{"tableHide":true,"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161211-165122_458885500","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:447","text":"","dateFinished":"2016-12-11T20:31:12-0800","dateStarted":"2016-12-11T20:31:12-0800","result":{"code":"SUCCESS","type":"TEXT","msg":""},"focus":true},{"title":"Prepare Data","text":"%psql.sql\n\nDROP TABLE IF EXISTS hawq.web_clicks;\nCREATE TABLE hawq.web_clicks (\n --wcs_user_sk BIGINT,-- column is used to identify prediction\n clicks_in_category BIGINT, --column is used as label, all following columns are used as input vector to the ml algorithm\n college_education  BIGINT,\n male               BIGINT,\n clicks_in_1        BIGINT,\n clicks_in_2        BIGINT,\n clicks_in_3        BIGINT,\n clicks_in_4        BIGINT,\n clicks_in_5        BIGINT,\n clicks_in_6        BIGINT,\n clicks_in_7        BIGINT\n)with (appendonly=true, orientation=parquet,compresstype=snappy)\nDISTRIBUTED RANDOMLY;\n\n\n\nINSERT INTO  hawq.web_clicks (\nSELECT\n  --wcs_user_sk,\n  clicks_in_category,\n  CASE WHEN cd_education_status like 'Advanced Degree' OR \n  \t        cd_education_status like 'College' OR  \n\t\t\tcd_education_status like '4 yr Degree' OR \n\t\t\tcd_education_status like '2 yr Degree' THEN 1 ELSE 0 END AS college_education,\n  CASE WHEN cd_gender = 'M' THEN 1 ELSE 0 END AS male,\n  clicks_in_1,\n  clicks_in_2,\n  clicks_in_3,\n  clicks_in_4,\n  clicks_in_5,\n  clicks_in_6,\n  clicks_in_7\nFROM( \n  SELECT \n    wcs_user_sk,\n    SUM( CASE WHEN i_category = 'Books' THEN 1 ELSE 0 END) AS clicks_in_category,\n    SUM( CASE WHEN i_category_id = 1 THEN 1 ELSE 0 END) AS clicks_in_1,\n    SUM( CASE WHEN i_category_id = 2 THEN 1 ELSE 0 END) AS clicks_in_2,\n    SUM( CASE WHEN i_category_id = 3 THEN 1 ELSE 0 END) AS clicks_in_3,\n    SUM( CASE WHEN i_category_id = 4 THEN 1 ELSE 0 END) AS clicks_in_4,\n    SUM( CASE WHEN i_category_id = 5 THEN 1 ELSE 0 END) AS clicks_in_5,\n    SUM( CASE WHEN i_category_id = 6 THEN 1 ELSE 0 END) AS clicks_in_6,\n    SUM( CASE WHEN i_category_id = 7 THEN 1 ELSE 0 END) AS clicks_in_7\n  FROM hawq.web_clickstreams\n  INNER JOIN hawq.item it ON (wcs_item_sk = i_item_sk\n                     AND wcs_user_sk IS NOT NULL)\n  GROUP BY  wcs_user_sk\n)q05_user_clicks_in_cat\nINNER JOIN hawq.customer ct ON wcs_user_sk = c_customer_sk\nINNER JOIN hawq.customer_demographics ON c_current_cdemo_sk = cd_demo_sk)\n;\nSET search_path = hawq;\n\n","dateUpdated":"2016-12-11T20:27:01-0800","config":{"colWidth":11,"tableHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Update Count","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"Update Count","index":0,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161005-150047_1274148424","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:448","dateFinished":"2016-12-11T20:27:08-0800","dateStarted":"2016-12-11T20:27:01-0800","focus":true},{"text":"%psql.sql\n\nselect * from web_clicks;","dateUpdated":"2016-12-11T20:27:14-0800","config":{"colWidth":11,"editorMode":"ace/mode/sql","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"clicks_in_category","index":0,"aggr":"sum"}],"values":[{"name":"college_education","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"clicks_in_category","index":0,"aggr":"sum"},"yAxis":{"name":"college_education","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161211-165438_1535677232","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:449","dateFinished":"2016-12-11T20:27:14-0800","dateStarted":"2016-12-11T20:27:14-0800","focus":true},{"title":"Train Model","text":"%psql.sql\n\ndrop table if exists web_clicks_linregr;\ndrop table if exists web_clicks_linregr_summary;\n\nSELECT madlib.linregr_train('web_clicks','web_clicks_linregr','clicks_in_category',\n'ARRAY[1,college_education,male,clicks_in_1,clicks_in_2,clicks_in_3,clicks_in_4,clicks_in_5,clicks_in_6,clicks_in_7]');","dateUpdated":"2016-12-11T20:29:53-0800","config":{"tableHide":true,"colWidth":11,"editorMode":"ace/mode/sql","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Update Count","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"Update Count","index":0,"aggr":"sum"}}},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161211-165207_828501094","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:450","dateFinished":"2016-12-11T20:29:49-0800","dateStarted":"2016-12-11T20:29:48-0800","focus":true},{"title":"Predict Using the Model","text":"%psql.sql\n\nSELECT web_clicks.*,\n       madlib.linregr_predict( ARRAY[1,college_education,male,clicks_in_1,clicks_in_2,clicks_in_3,clicks_in_4,clicks_in_5,clicks_in_6,clicks_in_7],\n                               m.coef\n                             ) as predict,\n        clicks_in_category -\n          madlib.linregr_predict(ARRAY[1,college_education,male,clicks_in_1,clicks_in_2,clicks_in_3,clicks_in_4,clicks_in_5,clicks_in_6,clicks_in_7],\n                                  m.coef\n                                ) as residual\nFROM web_clicks, web_clicks_linregr m;","dateUpdated":"2016-12-11T20:29:55-0800","config":{"colWidth":11,"editorMode":"ace/mode/sql","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"clicks_in_category","index":0,"aggr":"sum"}],"values":[{"name":"college_education","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"clicks_in_category","index":0,"aggr":"sum"},"yAxis":{"name":"college_education","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685604_1643597169","id":"20161211-172250_1841221220","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:451","dateFinished":"2016-12-11T20:29:55-0800","dateStarted":"2016-12-11T20:29:55-0800","focus":true},{"title":"Use K-Means Cluster to classify customers into segments of Reading Interests.","dateUpdated":"2016-12-11T20:30:47-0800","config":{"colWidth":12,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685605_1643212420","id":"20161211-172248_2073384360","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:452","dateFinished":"2016-12-11T20:31:12-0800","dateStarted":"2016-12-11T20:31:12-0800","result":{"code":"SUCCESS","type":"TEXT","msg":""},"text":"","focus":true},{"title":"Prepare Data","text":"%psql.sql \n\nDROP TABLE IF EXISTS book_group_data;\nCREATE TABLE book_group_data (\n  cid  BIGINT,\n  id1  float,\n  id2  float,\n  id3  float,\n  id4  float,\n  id5  float,\n  id6  float,\n  id7  float,\n  id8  float,\n  id9  float,\n  id10 float,\n  id11 float,\n  id12 float,\n  id13 float,\n  id14 float,\n  id15 float\n);\n\nINSERT INTO  book_group_data (\nSELECT\n  ss.ss_customer_sk AS cid,\n  count(CASE WHEN i.i_class_id=1  THEN 1 ELSE NULL END) AS id1,\n  count(CASE WHEN i.i_class_id=2  THEN 1 ELSE NULL END) AS id2,\n  count(CASE WHEN i.i_class_id=3  THEN 1 ELSE NULL END) AS id3,\n  count(CASE WHEN i.i_class_id=4  THEN 1 ELSE NULL END) AS id4,\n  count(CASE WHEN i.i_class_id=5  THEN 1 ELSE NULL END) AS id5,\n  count(CASE WHEN i.i_class_id=6  THEN 1 ELSE NULL END) AS id6,\n  count(CASE WHEN i.i_class_id=7  THEN 1 ELSE NULL END) AS id7,\n  count(CASE WHEN i.i_class_id=8  THEN 1 ELSE NULL END) AS id8,\n  count(CASE WHEN i.i_class_id=9  THEN 1 ELSE NULL END) AS id9,\n  count(CASE WHEN i.i_class_id=10 THEN 1 ELSE NULL END) AS id10,\n  count(CASE WHEN i.i_class_id=11 THEN 1 ELSE NULL END) AS id11,\n  count(CASE WHEN i.i_class_id=12 THEN 1 ELSE NULL END) AS id12,\n  count(CASE WHEN i.i_class_id=13 THEN 1 ELSE NULL END) AS id13,\n  count(CASE WHEN i.i_class_id=14 THEN 1 ELSE NULL END) AS id14,\n  count(CASE WHEN i.i_class_id=15 THEN 1 ELSE NULL END) AS id15\nFROM hawq.store_sales ss\nINNER JOIN hawq.item i \n  ON (ss.ss_item_sk = i.i_item_sk\n  AND i.i_category like 'Books'\n  AND ss.ss_customer_sk IS NOT NULL\n)\nGROUP BY ss.ss_customer_sk\nHAVING count(ss.ss_item_sk) > 5\n--CLUSTER BY cid --cluster by preceded by group by is silently ignored by hive but fails in spark\nORDER BY cid)\n;\n\ndrop view if exists book_group_params;\nCREATE VIEW book_group_params AS (SELECT *,ARRAY[id1,id2,id3,id4,id5,id6,id7,id8,id9,id10,id11,id12,id13,id14,id15] as features FROM book_group_data);\n\nCREATE OR REPLACE FUNCTION unnest_2d_1d(anyarray)\n  RETURNS SETOF anyarray AS\n$func$\nSELECT array_agg($1[d1][d2])\nFROM   generate_series(array_lower($1,1), array_upper($1,1)) d1\n     , generate_series(array_lower($1,2), array_upper($1,2)) d2\nGROUP  BY d1\nORDER  BY d1\n$func$\nLANGUAGE SQL IMMUTABLE;","dateUpdated":"2016-12-11T20:29:58-0800","config":{"tableHide":true,"colWidth":11,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Update Count","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"Update Count","index":0,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685605_1643212420","id":"20161211-172245_939066205","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:453","dateFinished":"2016-12-11T20:30:00-0800","dateStarted":"2016-12-11T20:29:59-0800","focus":true},{"title":"Generate Cluster Series Information","text":"%psql.sql\n\ndrop table if exists book_group_result;\nCREATE TABLE book_group_result AS \nSELECT generate_series(array_lower(centroids,1), array_upper(centroids, 1)) as c, unnest_2d_1d(centroids) as centroids\nFROM  (select * from  madlib.kmeans_random('book_group_params',\n               'features',\n               5,\n                'madlib.dist_norm2',\n                              'madlib.avg', \n                              100, 0\n            )) q1;","dateUpdated":"2016-12-11T20:30:04-0800","config":{"tableHide":true,"colWidth":11,"editorMode":"ace/mode/sql","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Update Count","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"Update Count","index":0,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685605_1643212420","id":"20161211-173055_1017649272","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:454","dateFinished":"2016-12-11T20:30:08-0800","dateStarted":"2016-12-11T20:30:04-0800","focus":true},{"text":"%psql.sql\nselect * from book_group_result;","dateUpdated":"2016-12-11T20:30:12-0800","config":{"colWidth":11,"editorMode":"ace/mode/sql","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685605_1643212420","id":"20161211-173230_1922866502","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:455","dateFinished":"2016-12-11T20:30:14-0800","dateStarted":"2016-12-11T20:30:12-0800","focus":true},{"title":"Classify Users with the K-Means Algorithm","text":"%psql.sql\n\ndrop table if exists book_group_classification;\nCREATE TABLE book_group_classification AS \nSELECT data.*, (madlib.closest_column(centroids, features)).column_id as cluster_id\nFROM book_group_params as data,\n     (SELECT centroids\n      FROM  madlib.kmeans_random('book_group_params',\n               'features',\n               5,\n                'madlib.dist_norm2',\n                              'madlib.avg', \n                              100, 0\n            )) as q1;\n","dateUpdated":"2016-12-11T20:30:07-0800","config":{"tableHide":true,"colWidth":11,"editorMode":"ace/mode/sql","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Update Count","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"Update Count","index":0,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685605_1643212420","id":"20161211-172752_478609351","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:456","dateFinished":"2016-12-11T20:30:14-0800","dateStarted":"2016-12-11T20:30:07-0800","focus":true},{"text":"%psql.sql\n\nselect * from  book_group_classification;","dateUpdated":"2016-12-11T20:30:19-0800","config":{"colWidth":11,"editorMode":"ace/mode/sql","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685606_1644366667","id":"20161211-172833_1590449968","dateCreated":"2016-12-11T08:08:05-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:457","dateFinished":"2016-12-11T20:30:19-0800","dateStarted":"2016-12-11T20:30:19-0800","focus":true},{"dateUpdated":"2016-12-11T08:08:05-0800","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481515685606_1644366667","id":"20161211-172908_2030400729","dateCreated":"2016-12-11T08:08:05-0800","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:458"}],"name":"HAWQ-Demonstration","id":"2C3C9R9B8","angularObjects":{"2C31S29ZG:shared_process":[],"2C4B8VVJ2:shared_process":[],"2C3J1BSYQ:shared_process":[],"2C52789PH:shared_process":[],"2C3NS9QXQ:shared_process":[],"2C5CXE9G7:shared_process":[],"2C5DQ4MD5:shared_process":[],"2C3CZ3WHN:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}